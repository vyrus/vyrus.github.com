<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
    <title>GitHub Pages - Home</title>
    <link href="/stylesheets/bundle_common.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/bundle_github.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/screen.css" media="screen" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <div id="main">
      <div id="header" class="basic">
 
        <div class="site">
          <div class="logo">
            <a href="/"><img src="/images/modules/header/logo_pages.png" alt="github pages" /></a>
          </div>
          <div class="actions">
            <a href="http://github.com">home</a>
            <a href="http://github.com/login">login</a>
            <a href="http://github.com/signup">signup!</a>
          </div>
        </div>
      </div>
 
      <div id="content" class="site">
      <div class="wikistyle">
        <h2>План отчёта</h2>

<ul>
<li>Описание базы данных</li>
<li>Описание основных запросов?</li>
<li>Описание кода (модели, контроллеры, формы)</li>
<li>Иерархия классов форм, функционирование</li>
<li>Подготовленные выражения <a href="http://phpclub.ru/detail/article/mysqli#part_4" title="Использование mysqli: подготовленные выражения">[4]</a></li>
<li>Обеспечение безопасности?

<ul>
<li>Радужные таблицы <a href="http://ru.wikipedia.org/wiki/%D0%A0%D0%B0%D0%B4%D1%83%D0%B6%D0%BD%D0%B0%D1%8F_%D1%82%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D0%B0" title="Радужная таблица">[5]</a></li>
<li>MD5 <a href="http://ru.wikipedia.org/wiki/MD5" title="MD5">[6]</a></li>
</ul></li>
</ul>

<h2>3.4 Организация работы с пользователями</h2>

<p>Разрабатываемая система подразумевает активное использование пользователями, 
поэтому взаимодействию между пользователями и системой уделено особое внимание.</p>

<p>В системе предусмотрена работа трёх категорий пользователей:</p>

<ul>
<li>администраторы;</li>
<li>преподаватели;</li>
<li>слушатели.</li>
</ul>

<p>Код, отвечающий за работу с пользователями сосредоточен в классе контроллера 
Controller&#95;Users, в классе модели Model&#95;User и в классе сервиса авторизации 
Auth.</p>

<ul>
<li>Контроллер - перечисление действий с кратким описанием.</li>
<li>Модель - краткое описание, наследование, подгрузка соединения с БД через менеджер ресурсов.</li>
<li>Константный enum.</li>
</ul>

<h2>3.4.1 Права пользователей</h2>

<p>Администратор:</p>

<ul>
<li>регистрирует новых сотрудников (администраторов и преподавателей);</li>
<li>формирует структуру образовательных программ;</li>
<li>добавляет материалы в образовательные программы;</li>
<li>назначает ответственных за дисциплины/курсы преподавателей;</li>
<li>назначает кураторов для слушателей;</li>
<li>обрабатывает заявки слушателей;</li>
<li>регистрирует платежи слушателей.</li>
</ul>

<p><img src="/images/admin-use-cases.png" alt="Диаграмма прецедентов администратора" /></p>

<p>Преподаватель:</p>

<ul>
<li>добавляет материалы в образовательные программы;</li>
<li>общается со слушателями, руководит учебным процессом;</li>
<li>проверяет контрольные задания.</li>
</ul>

<p><img src="/images/teacher-use-cases.png" alt="Диаграмма прецедентов преподавателя" /></p>

<p>Слушатель:</p>

<ul>
<li>подаёт заявки на образовательные программы;</li>
<li>просматривает материалы образовательных программ;</li>
<li>общается с преподавателями/куратором;</li>
<li>выполняет контрольные задания.</li>
</ul>

<p><img src="/images/student-use-cases.png" alt="Диаграмма прецедентов слушателя" /></p>

<h2>3.4.2 Регистрация пользователей в системе</h2>

<p>Процесс регистрации предназначен для внесения в систему данных о новом 
пользователе, определения его прав на доступ к различным частям системы и 
назначения ему внутреннего идентификатора.</p>

<p>Регистрация слушателей осуществляется самими пользователями, желающими пройти 
обучение. В то время, как регистрация сотрудников в системе производится 
администратором.</p>

<p>За регистрацию сотрудников отвечает метод Controller&#95;Users::action&#95;register&#95;employee().
При помощи класса формы Form&#95;Profile&#95;Employee&#95;Registration он получает данные от 
браузера пользователя и проводит их валидацию.</p>

<p>При регистрации администратора заполняются следующие поля формы:</p>

<ul>
<li>фамилия;</li>
<li>имя;</li>
<li>отчество;</li>
<li>логин;</li>
<li>e-mail.</li>
</ul>

<p>Если данные проходят проверку, то создаётся экземпляр модели для работы с пользователями, 
и данные передаются вместе с ролью нового пользователя в метод Model&#95;User::register().
Данный метод выполняет подготовку запроса на добавление новой записи пользователя 
в базу данных:</p>

<pre><code>INSERT INTO users
(login, passwd, role, email, surname, name, patronymic, status)
VALUES
(:login, :passwd, :role, :email, :surname, :name, :patronymic, :status) 
</code></pre>

<p>Затем модель шифрует пароль необратимым методом для дополнительной безопасти. 
Для этого через менеджер ресурсов модель получает ссылку на экземпляр сервиса 
авторизации и вызывает метод Auth::getPasswdHash(), передавая ему строку с 
паролем. Этот метод производит хеширование пароля алгоритмом MD5 <a href="http://ru.wikipedia.org/wiki/MD5" title="MD5">[6]</a> 
в несколько раундов и с применением случайной последовательности символов, что 
даёт усиление защиты от взлома при помощи радужных таблиц <a href="http://ru.wikipedia.org/wiki/%D0%A0%D0%B0%D0%B4%D1%83%D0%B6%D0%BD%D0%B0%D1%8F_%D1%82%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D0%B0" title="Радужная таблица">[5]</a>.</p>

<p>После вычисления хеша пароля он вместе с другим набором данных передаётся в объект 
взаимодействия с СУБД для выполнения с ранее подготовленным запросом. Затем на 
указанный адрес электронной почты
пользователю отправляется сообщение, в котором содержится ссылка для активации 
созданной учётной записи. В процессе активации системой будет сгенерирован и 
установлен пароль для аутентификации пользователя. Автоматическая генерация 
пароля для учётных записей сотрудников предназначена для предотвращения 
установки легко подбираемых паролей, что также повышает защищённость системы от 
взлома. В отличие от сотрудников, слушатели в процессе регистрации сами задают 
пароль для аутентификации.</p>

<p>Процесс регистрации преподавателя аналогичен регистрации администратора, но 
создаётся запись о пользователе с другой ролью и, соответственно, с другим набором прав в 
системе.</p>

<p>Процесс регистрации слушателя делится на два этапа: первичная регистрация и 
вторичная. За регистрацию слушателей отвечает метод Controller&#95;Users::action&#95;register&#95;student().
В ходе первичной регистрации указываются только базовые поля данных пользователя 
(базовый профиль):</p>

<ul>
<li>логин;</li>
<li>пароль;</li>
<li>e-mail.</li>
</ul>

<p>Поэтому в коде данного действия используется другой класс формы, нежели чем при 
регистрации сотрудника, — Form&#95;Profile&#95;Student&#95;Registration. Аналогично 
описанному выше процессу регистрации сотрудника происходит получение данных от 
браузера, их валидации, сохранение в базе данных (с тем отличием, что при 
добавлении записи в базу используется значение поля роли Model_User::ROLE&#95;STUDENT,
то есть — слушатель) и отправкой новому слушателю на указанный адрес электронной 
почты уведомления, в котором содержится ссылка для активации учётной записи. </p>

<p>После первичной регистрации слушатель может получить доступ только к бесплатным 
образовательным программам. Для того, чтобы получить доступ к платным программам, 
пользователь должен пройти вторичную регистрацию, в ходе которой требуется ввести 
в систему подробную информацию о себе (расширенный профиль):</p>

<ul>
<li>фамилия;</li>
<li>имя;</li>
<li>отчество;</li>
<li>дата рождения (в формате дд.мм.гггг);</li>
<li>паспортные данные:

<ul>
<li>серия (4-ре цифры);</li>
<li>номер (6-ть цифр);</li>
<li>прописка:

<ul>
<li>область/край;</li>
<li>город;</li>
<li>улица;</li>
<li>дом/корпус;</li>
<li>квартира/комната.</li>
</ul></li>
</ul></li>
<li>сведения об имеющемся образовании:

<ul>
<li>вид документа (диплом о высшем образовании, диплом о среднем 
профессиональном образовании или иное);</li>
<li>номер документа;</li>
<li>год окончания;</li>
<li>специальность;</li>
<li>квалификация.</li>
</ul></li>
<li>контактные телефоны:

<ul>
<li>мобильный;</li>
<li>домашний/рабочий (стационарный).</li>
</ul></li>
</ul>

<p>Процесс вторичной регистрации реализует метод-действие Controller<em>Users::action</em>profile_extended() 
и, соответственно, ещё один класс формы Form&#95;Profile&#95;Student&#95;Extended. Данные 
действие контроллера и класс формы предоставляют интерфейс просмотра и 
редактирования расширенного профиля слушателя. Если этот профиль пуст, как в 
случае с вновь зарегистрированным пользователем, то ему будет показана форма с 
пустыми полями и предложением её заполнить. Если же профиль уже был заполнен 
ранее, то форма будет заполнена введёнными данными. Слушатель может их 
скорректировать при необходимости и сохранить.</p>

<p>Поскольку форма содержит довольно большое число полей, для упрощения их обработки 
внутри системы используются специализированные классы-контейнеры: Model&#95;User&#95;Passport, 
Model&#95;User&#95;EduDoc и Model&#95;User&#95;Phones, служащие для хранения соответственно 
паспортных данных, данных о документе об образовании и данных о телефонах 
пользователя. Сами классы содержат перечисления полей и ассоциации между полями 
формы и полями в базе данных. Но они наследуют от абстрактного класса Model&#95;User&#95;Abstract 
методы, которые и делают непосредственно работу по обслуживанию данных. 
Перечислим эти методы:</p>

<ol>
<li>Model&#95;User&#95;Abstract::fromRow(), служит для заполнение контейнера 
данными из записи базы данных, параметром для него является массив 
значений полей;</li>
<li>Model&#95;User&#95;Abstract::fromForm(), сохраняет в контейнере информацию из 
формы расширенного профиля слушателя, параметр - объект класса 
Form&#95;Profile&#95;Student&#95;Extended;</li>
<li>Model&#95;User&#95;Abstract::toForm(), заполняет поля форму данными из 
контейнера, параметром является также объект класса 
Form&#95;Profile&#95;Student&#95;Extended.</li>
</ol>

<p>После заполнения контейнера, к его полям можно обращаться, как к свойствам 
(атрибутам) класса. При обновлении данных расширенного профиля слушателя три 
этих заполненных на основе формы контейнера передаются методам модели 
пользователя: Model&#95;User::savePassport(), Model&#95;User::saveEduDoc() и 
Model&#95;User::savePhones(). Эти методы в качестве первого параметра принимают 
идентификатор пользователя, указывающий для какого слушателя производится 
обновление записи, и соответствующий методу контейнер.</p>

<p>Для реализации просмотра администратором расширенного профиля слушателя, а 
именно администратор на основании в том числе данных профиля принимает решение о 
предоставлении допуска слушателю к желаемым образовательным программам, 
используется действие контроллера Controller&#95;Users::action&#95;view&#95;profile(). Этот 
метод создаёт экземпляр модели для работы с пользователя и при помощи метода 
Model&#95;User::getExtendedProfile() получает массив с тремя описанными выше 
контейнерами, содержащими требуемую информацию, и передаёт их шаблону отображения 
для вывода пользователю.</p>

<p>Использование такого рода контейнеров для обработки данных повышает гибкость 
кода, что благоприятно сказывается на читабельности кода и скорость дальнейшей 
разработки в случае модификации и/или доработки логики работы с профилями 
слушателей.</p>

<h2>3.4.3 Активация учётных записей</h2>

<p>Все новые зарегистрированные учётные записи (как сотрудников, так и слушателей) не 
активны и должны пройти активацию для подтверждения адреса электронной почты 
e-mail.</p>

<h2>Авторизация пользователей</h2>

<p>Авторизация (англ. authorization) — процесс, а также результат процесса проверки 
необходимых параметров и предоставление определённых полномочий лицу или группе 
лиц (прав доступа) на выполнение некоторых действий в различных системах с 
ограниченным доступом. <a href="http://otvet.mail.ru/question/19223738/" title="Что такое авторизация?">[1]</a></p>

<p>Авторизация это не тоже самое что и аутентификация: аутентификация — это 
установление подлинности лица, а авторизация — предоставление этому лицу 
некоторых прав или проверка их наличия (как правило — следующий шаг системы 
после аутентификации). <a href="http://ru.wikipedia.org/wiki/%D0%90%D0%B2%D1%82%D0%BE%D1%80%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F" title="Авторизация">[3]</a></p>

<h2>Контроль прав доступа</h2>

<ol>
<li>$config['permissions'], Mvc_Dispatcher;</li>
<li>Model_User::getAuth().</li>
<li><a href="http://ru.wikipedia.org/wiki/%D0%98%D0%B7%D0%B1%D0%B8%D1%80%D0%B0%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5_%D1%83%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%BE%D0%BC" title="Избирательное управление доступом">Избирательное управление доступом</a></li>
</ol>

<h2>Восстановление пароля пользователя</h2>

<p>На случай, если пользователь забудет свой пароль для аутентификации в системе, 
предусмотрена функция восстановления пароля. Восстановление пароля могут 
запрашивать как слушатели, так и сотрудники.</p>

<p>Для восстановления паролей пользователей используется следующая схема. 
Пользователь, который забыл свой пароль, делает запрос на восстановление пароля.
Для того, чтобы сделать такой запрос он должен ввести адрес электронной почты, 
который использовался при регистрации в системе. Приложение ищет запись в 
таблице пользователей с указанным адресом. Если такая запись существуется, то 
есть пользователем с таким адресом действительно зарегистрирован в системе, то 
генерируется специальный код восстановления, который отправляется пользователю 
по электронной почте в виде ссылки на специальную страницу.</p>

<p>Код получается путём хеширования строки данных, в которой содержится 
идентификатор пользователя и дата генерации кода. Хеширование, так как же, как 
и в случае с хешированием пароля для сохранения в базе данных, производится в 
несколько раундов с добавлением к данным случайной последовательности символов 
(устанавливаемая в файле конфигурации системы). Этим достигается следующее:</p>

<ol>
<li>код восстановление уникален для каждого пользователя; </li>
<li>код восстановления действителен только в течении дня, когда был сгенерирован.</li>
</ol>

<p>Благодаря первому свойству, потенциальный злоумышленник не сможем вычислить код 
восстановления, даже если алгоритм хеширования будет скомпрометирован, 
без знания идентификатора пользователя и случайной последовательности символов. 
Благодаря второму свойству, код имеет ограниченный срок действия, что не 
позволит злоумышленнику использовать его, спустя некоторое время после 
генерации.</p>

<p>После того, как пользователь получит письмо с ссылкой для восстановления и 
пройдёт по ней, он может установить новый пароль для учётной записи. В ссылке 
содержится идентификатор пользователя и код восстановления, и при запросе 
страницы смены пароля у системы, заново рассчитывается код восстановления и 
сравнивается с переданным. Если они совпадают, то, соответственно, пользователю 
даётся доступ на смену пароля.</p>

<h2>Классы форм</h2>

<ol>
<li>Что такое валидация?</li>
</ol>

<h2>Литература</h2>

<ol>
<li><a href="http://otvet.mail.ru/question/19223738/" title="Что такое авторизация?">Что такое авторизация?</a></li>
<li><a href="http://ru.wikipedia.org/wiki/%D0%98%D0%B7%D0%B1%D0%B8%D1%80%D0%B0%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5_%D1%83%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%BE%D0%BC" title="Избирательное управление доступом">Избирательное управление доступом</a></li>
<li><a href="http://ru.wikipedia.org/wiki/%D0%90%D0%B2%D1%82%D0%BE%D1%80%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F" title="Авторизация">Авторизация</a></li>
<li><a href="http://phpclub.ru/detail/article/mysqli#part_4" title="Использование mysqli: подготовленные выражения">Использование mysqli: подготовленные выражения</a></li>
<li><a href="http://ru.wikipedia.org/wiki/%D0%A0%D0%B0%D0%B4%D1%83%D0%B6%D0%BD%D0%B0%D1%8F_%D1%82%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D0%B0" title="Радужная таблица">Радужные таблицы</a></li>
<li><a href="http://ru.wikipedia.org/wiki/MD5" title="MD5">MD5</a></li>
</ol>

      </div>
      </div>
 
      <div class="push"></div>
    </div>
 
    <div id="footer">
      <div class="site">
 
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">T-Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Git Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://github.wordpress.com">Status</a>
          </div>
          <div class="company">
            GitHub is <a href="http://logicalawesome.com/">Logical Awesome</a> &copy;2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <div>
            Powered by the <a href="http://www.rackspace.com ">Dedicated
            Servers</a> and<br/> <a href="http://www.rackspacecloud.com">Cloud
            Computing</a> of Rackspace Hosting<span>&reg;</span>
          </div>
          <a href="http://www.rackspace.com">
            <img src="/images/modules/footer/rackspace_logo.png" alt="Dedicated Server" />
          </a>
        </div>
      </div>
    </div>
 
  </body>
</html>