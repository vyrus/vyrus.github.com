<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
    <title>GitHub Pages - Home</title>
    <link href="/stylesheets/bundle_common.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/bundle_github.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/screen.css" media="screen" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <div id="main">
      <div id="header" class="basic">
 
        <div class="site">
          <div class="logo">
            <a href="/"><img src="/images/modules/header/logo_pages.png" alt="github pages" /></a>
          </div>
          <div class="actions">
            <a href="http://github.com">home</a>
            <a href="http://github.com/login">login</a>
            <a href="http://github.com/signup">signup!</a>
          </div>
        </div>
      </div>
 
      <div id="content" class="site">
      <div class="wikistyle">
        <h1>Описание архитектуры</h1>

<p>Здесь представлено описание взаимодействия частей системы в процессе обработки
запроса.</p>

<h2>Шаг 1</h2>

<p><img src="/images/arch-step-1.png" alt="Шаг 1" /></p>

<p>На первом шаге создаётся экземпляр менеджера ресурсов. Он предназначен для 
инициализации и обращения к различным активным элементами архитектуры (для 
простоты будем называть их ресурсами). Причём реальные экземпляры ресурсов 
создаются лишь в момент первого обращения к ним, а в дальнейшем ссылка на этот 
экземпляр сохраняется в менеджере. Таким образом реализуется механизм поздней 
загрузки, одновременно остающийся прозрачным для других частей системы и 
инкапсулированный внутри одной абстракции.</p>

<p>При создании менеджеру ресурсов 
передаётся конфигурация системы, то есть параметры настройки, влияющие на 
поведение системы в конкретном рабочем окружении. Перечислим эти параметры:</p>

<ul>
<li><p>режим работы системы;</p>

<p>позволяет выбирать режим функционирования системы: в режиме отладки или в 
рабочем режиме. Первый спользуется в процессе разработки, он позволяет 
выявлять ошибки в коде, отображая отладочную информацию о процессе работы 
системы (дерево вызовов, аргументы функций и методов и т.д.). Во втором 
режиме отладочная информация не отображается  пользователям системы 
(поскольку она не должна попадать посторонним с точки зрения безопасности 
функционирования сервера), но записывается в специальный файл журнала, 
которой впоследствии может быть проанализирован системным администратором.</p></li>
<li><p>адрес сайта;</p>

<p>базовый адрес сайта, который будет в дальнейшем использоваться системой при 
генерации ссылок на сайте и в почтовых сообщениях, отправляемых 
пользователям.</p></li>
<li><p>настройки соединения с базой данных;</p>

<p>сюда входят такие параметры, как СУБД, с которой будет осушествляться 
работа, сервер, имя пользователя, пароль. Допольнительно могут быть указаны 
опции, специфичные для какой-то либо конкретной СУБД.</p></li>
<li><p>маршруты;</p>

<p>маршруты позволяют связывать запросы к веб-серверу с их непосредственными 
обработчиками в коде разрабатываемого приложения.</p></li>
<li><p>права доступа пользователей;</p>

<p>в зависимости от ролей пользователей в системе они имеют доступ к 
определённому набору страниц. Этот параметр служит для установления 
ассоциаций между ролями пользователей и обработчиками запросов (парами 
"контроллер-действие"), к которым пользователю разрешён доступ.</p></li>
<li><p>строка для шифрования данных авторизации;</p>

<p>пароли пользователей и некоторая другая информация, являющаяся 
чувствительной с точки зрения безопасности, сохраняется в базе с помощью 
необратимого алгоритма шифрования (хеширования), чтобы в случае, если 
потенциальный злоумышленник сможет считать такого рода информацию из базы 
данных, он не получил полного контроля над учётными записями пользователей. 
Для усиления хеш-функции применяется строка, состоящая из случайных 
символов, привносящая дополнительные степень неопределённость и, 
следовательно, стойкость к перебору в получаемые хеши.</p></li>
<li><p>настройки отправки почтовых сообщений.</p>

<p>в процессе работы с системой пользователям могут отправлять электронные 
почтовые сообщения. Данный параметр задаёт такие настройки, как используемый
для отправки транспорт (локальный агент передачи почты или удалённый 
SMTP-сервер), адрес и имя отправителя, данные для авторизации на 
SMTP-сервере (если выбран соответствующий транспорт).</p></li>
</ul>

<p>В целом, менеджер ресурсов представляет собой реализацию одной из форм активной 
инверсии зависимостей в коде, используемых при построении 
объектно-ориентированных систем. Эта форма называется "dependency lookup: pull 
approach" и предполагает наличие в системе общедоступного объекта, который 
знает обо всех используемых сервисах. Таким образом все зависимости 
инкапсулируются внутри этого объекта и остальные части системы могут 
запрашивать по мере необходимые сервисы у него. <a href="http://wiki.agiledev.ru/doku.php?id=ooad:dependency_injection" title="Инверсия зависимостей при проектировании Объектно-Ориентированных систем">[1]</a></p>

<h2>Шаг 2</h2>

<p><img src="/images/arch-step-2.png" alt="Шаг 2" /></p>

<p>На втором шаге создается экземпляр диспетчера запросов. Его предназначение 
состоит в том, чтобы при помощи маршрутизатора и сервиса авторизации 
делегировать управление необходимому в данный момент обработчику. Посколько 
систему построена с использованием парадигмы MVC, то обработчиками запросов в 
данном случае выступают контроллеры, а точнее отдельные их действия.</p>

<h2>Шаг 3</h2>

<p><img src="/images/arch-step-3.png" alt="Шаг 3" /></p>

<pre><code>@todo Блин... Куки... Как-то не очень звучит +) Может можно подобрать 
термин посерьёзнее? :)

@todo Расписать про кукисы - [2]
</code></pre>

<p>Создаётся контейнер, содержащий практически всю информацию о запросе к 
веб-серверу. Сюда входят данные, переданные браузером пользователя 
HTTP-методами GET и POST, куки и переменные окружения веб-сервера. Такой 
контейнер создаёт дополнительный слой абстракции для системы, позволяя собрать 
зависимости различных частей от глобальных переменных, содержащих данные о 
запросе, в одной и поэтому легко контролируемой сущности. И этот контейнер 
передаётся для обработки диспетчеру запросов.</p>

<h2>Шаг 4</h2>

<p><img src="/images/arch-step-4.png" alt="Шаг 4" /></p>

<p>На четвёртом шаге порождается экземпляр маршрутизатора, задачей которого 
является поиск среди настроенных в конфигурационных данных маршрута, шаблон 
которого совпадает с текущей запрашиваемой страницей.</p>

<pre><code>@todo Расписать про регексы - [3]
</code></pre>

<p>Маршрут состоит из следующих полей данных:</p>

<ul>
<li><p>алиас</p>

<p>краткое обозначение маршрута.</p></li>
<li><p>тип</p>

<p>статичный или с использованием регулярных выражений.</p></li>
<li><p>шаблон</p>

<p>для установления соответствия строки запроса и маршрута</p></li>
<li><p>обработчик</p>

<p>контроллер-действие</p></li>
<li><p>параметры</p>

<p>данные извлекаемые из запроса или заданные вручную для маршрута и 
передаваемые в обработчик</p></li>
</ul>

<h2>Шаг 5</h2>

<p><img src="/images/arch-step-5.png" alt="Шаг 5" /></p>

<p>Проверяется, закрыт ли публичный доступ к запрашиваемой странице, и если да, то 
опрашивается сервис авторизации на предмет наличия у текущего пользователя 
необходимых прав на доступ.</p>

<h2>Шаг 6</h2>

<p><img src="/images/arch-step-6.png" alt="Шаг 6" /></p>

<p>Диспетчер загружает код соответствующего класса-контроллера, создаёт его 
экземпляр и передаёт управление одному из его методов, реализующих запрошенное 
действие, вместе со списком параметров.</p>

<h2>Шаг 7</h2>

<p><img src="/images/arch-step-7.png" alt="Шаг 7" /></p>

<p>Выполняется запрошенное действие контроллера. В процессе контроллер может 
делать вызовы методов модели. Модели служат для представления 
предметно-ориентированных данных и манипулирования ими. Основная их работа 
связана с объектом взаимодейтсвия с базой данных, ссылку на которой они 
получают через менеджер ресурсов. </p>

<pre><code>@todo Расписать про PDO - [4], [5]
</code></pre>

<p>Также контроллер может обращаться к вспомогательному объекту формы, который 
упрощает взаимодействие с HTTP-формами.</p>

<pre><code>@todo Расписать про формы - [6]
</code></pre>

<h2>Шаг 8</h2>

<p><img src="/images/arch-step-8.png" alt="Шаг 8" /></p>

<p>Кроме того, контроллер может обращаться к сервису авторизации для реализации 
дополнительной логики на основе данных текущего пользователя, например, его 
роли в системе.</p>

<p>А также контроллер может использовать менеджер ссылок. Он позволяет получать 
ссылки на различные страницы системы на основе настроенных маршрутов.</p>

<p>Обращение к обоим объектам происходит через менеджер ресурсов.</p>

<h2>Шаг 9</h2>

<p><img src="/images/arch-step-9.png" alt="Шаг 9" /></p>

<p>В ходе выполнения действия контроллера создаётся набор переменных, которые будут
переданы представлению. После завершения работы контроллер запрашивает у 
менеджера ресурсов объект отображения шаблонов, которому передаётся управление 
вместе со сформированным набором переменных. Затем происходит обработка 
шаблонов трёх уровней (шаблон страницы, шаблоны элементов и шаблон макета) и 
выдача пользователю сформированной страницы.</p>

<h2>Шаг 10</h2>

<p><img src="/images/arch-step-10.png" alt="Шаг 10" /></p>

<p>В процессе обработки шаблонов представления могут, как и в случае работы 
контроллеров, вызываться (опять же через менеджер ресурсов) менеджер ссылок и 
объекты форм - оба являются источниками необходимых для сборки итоговых страниц 
данных.</p>

<pre><code>@todo Почитать комменты к коду, может ещё что вспомнится, о чём тут можно 
написать.
</code></pre>

<h2>Литература</h2>

<ol>
<li><a href="http://wiki.agiledev.ru/doku.php?id=ooad:dependency_injection" title="Инверсия зависимостей при проектировании Объектно-Ориентированных систем">Инверсия зависимостей при проектировании Объектно-Ориентированных систем</a> </li>
<li><a href="http://ru.wikipedia.org/wiki/HTTP_cookie" title="HTTP Cookie">HTTP Cookie</a></li>
<li><a href="http://ru.wikipedia.org/wiki/%D0%A0%D0%B5%D0%B3%D1%83%D0%BB%D1%8F%D1%80%D0%BD%D1%8B%D0%B5_%D0%B2%D1%8B%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F" title="Регулярные выражения">Регулярные выражения</a></li>
<li><a href="http://www.php.net/manual/en/intro.pdo.php" title="PDO: Introduction">PDO: Introduction</a></li>
<li><a href="http://ru.wikipedia.org/wiki/PHP_Data_Objects" title="PHP Data Objects">PHP Data Objects</a></li>
<li><a href="http://en.wikipedia.org/wiki/Form_(web)" title="Form (web)">Form (web)</a></li>
</ol>

      </div>
      </div>
 
      <div class="push"></div>
    </div>
 
    <div id="footer">
      <div class="site">
 
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">T-Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Git Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://github.wordpress.com">Status</a>
          </div>
          <div class="company">
            GitHub is <a href="http://logicalawesome.com/">Logical Awesome</a> &copy;2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <div>
            Powered by the <a href="http://www.rackspace.com ">Dedicated
            Servers</a> and<br/> <a href="http://www.rackspacecloud.com">Cloud
            Computing</a> of Rackspace Hosting<span>&reg;</span>
          </div>
          <a href="http://www.rackspace.com">
            <img src="/images/modules/footer/rackspace_logo.png" alt="Dedicated Server" />
          </a>
        </div>
      </div>
    </div>
 
  </body>
</html>